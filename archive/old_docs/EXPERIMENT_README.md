# å®Œæ•´å®éªŒè¯´æ˜

## å®éªŒç›®æ ‡

ç³»ç»Ÿæ€§è¯„ä¼°**åºåˆ—è¡¥å…¨å¯¹å›å½’ä»»åŠ¡çš„å½±å“**ï¼Œå›ç­”ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š

1. **å°‘é‡åºåˆ—è¡¥å…¨åå›å½’ vs ç›´æ¥å›å½’ï¼Œå“ªä¸ªæ›´å¥½ï¼Ÿ**
2. **è¡¥å…¨éƒ¨åˆ†æ—¶é—´ vs è¡¥å…¨å…¨éƒ¨æ—¶é—´ï¼Œæœ€ä¼˜ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ**

## å®éªŒè®¾è®¡

### å®éªŒAï¼šè¡¥å…¨ vs ä¸è¡¥å…¨

**å¯¹æ¯”ä¸¤ç§æ–¹æ³•**ï¼š
```
æ–¹æ³•1: ç›´æ¥å›å½’
å‰Næœˆ â”€â”€â†’ [LSTM] â”€â”€â†’ äº§é‡é¢„æµ‹

æ–¹æ³•2: ä¸¤é˜¶æ®µï¼ˆè¡¥å…¨ï¼‰
å‰Næœˆ â”€â”€â†’ [Stage1: è¡¥å…¨] â”€â”€â†’ å®Œæ•´36æœˆ â”€â”€â†’ [Stage2: å›å½’] â”€â”€â†’ äº§é‡é¢„æµ‹
```

**æµ‹è¯•è¾“å…¥é•¿åº¦**ï¼š6, 12, 18, 24ä¸ªæœˆ

**è¯„ä¼°æŒ‡æ ‡**ï¼š
- RMSE (Root Mean Square Error)
- MAE (Mean Absolute Error)
- RÂ² (å†³å®šç³»æ•°)
- MAPE (å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®)

**è¡¥å……åˆ†æ**ï¼š
- è¡¥å…¨è´¨é‡ï¼ˆåºåˆ—RMSEã€ç›¸å…³ç³»æ•°ï¼‰
- è¯¯å·®åˆ†å¸ƒ
- ç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒ

### å®éªŒBï¼šä¸åŒè¡¥å…¨é•¿åº¦

**å›ºå®šè¾“å…¥**ï¼š12ä¸ªæœˆ

**æµ‹è¯•è¡¥å…¨ç›®æ ‡**ï¼š
- åŸºçº¿ï¼šä¸è¡¥å…¨ï¼ˆç›´æ¥å›å½’ï¼‰
- è¡¥å…¨åˆ°18ä¸ªæœˆ (+6æœˆ)
- è¡¥å…¨åˆ°24ä¸ªæœˆ (+12æœˆ)
- è¡¥å…¨åˆ°30ä¸ªæœˆ (+18æœˆ)
- è¡¥å…¨åˆ°36ä¸ªæœˆ (+24æœˆ)

**ç ”ç©¶é—®é¢˜**ï¼š
- æ˜¯å¦å­˜åœ¨æœ€ä¼˜è¡¥å…¨é•¿åº¦ï¼Ÿ
- è¡¥å…¨è¶Šå¤šè¶Šå¥½ï¼Œè¿˜æ˜¯é€‚åº¦è¡¥å…¨æœ€ä½³ï¼Ÿ
- è¿‡åº¦è¡¥å…¨æ˜¯å¦å¼•å…¥å™ªéŸ³ï¼Ÿ

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…ä¾èµ–
pip install torch numpy pandas scikit-learn matplotlib seaborn scipy

# ç¡®ä¿æ•°æ®æ–‡ä»¶å­˜åœ¨
ls extract2019_20251010_165007.csv
ls extract2020_20251010_165007.csv
ls extract2021_20251010_165007.csv
ls extract2022_20251010_165007.csv
```

### 2. å¿«é€ŸéªŒè¯ï¼ˆ30åˆ†é’Ÿï¼‰

åœ¨è¿è¡Œå®Œæ•´å®éªŒå‰ï¼Œå…ˆå¿«é€ŸéªŒè¯å®éªŒè®¾è®¡ï¼š

```bash
python quick_validation.py
```

**è¾“å‡º**ï¼š
- 3ç§è¾“å…¥é•¿åº¦çš„åˆæ­¥å¯¹æ¯”
- å¹³å‡æ€§èƒ½å·®å¼‚
- æ˜¯å¦å€¼å¾—è¿è¡Œå®Œæ•´å®éªŒ

**é¢„æœŸç»“æœ**ï¼š
- å¦‚æœç›´æ¥æ³•æ˜æ˜¾æ›´å¥½ï¼ˆ>5%æå‡ï¼‰ï¼Œç»§ç»­å®Œæ•´å®éªŒéªŒè¯
- å¦‚æœä¸¤é˜¶æ®µæ›´å¥½ï¼Œæ£€æŸ¥å®éªŒè®¾è®¡
- å¦‚æœæ¥è¿‘ï¼Œéœ€è¦å®Œæ•´å®éªŒç¡®å®š

### 3. å®Œæ•´å®éªŒï¼ˆ8-12å°æ—¶ï¼‰

```bash
python run_full_experiment.py
```

**å®éªŒæµç¨‹**ï¼š

```
å¼€å§‹
  â”œâ”€ å®éªŒA: è¡¥å…¨ vs ä¸è¡¥å…¨
  â”‚   â”œâ”€ è¾“å…¥=6æœˆ
  â”‚   â”‚   â”œâ”€ è®­ç»ƒç›´æ¥å›å½’æ¨¡å‹
  â”‚   â”‚   â””â”€ è®­ç»ƒä¸¤é˜¶æ®µæ¨¡å‹
  â”‚   â”œâ”€ è¾“å…¥=12æœˆ
  â”‚   â”œâ”€ è¾“å…¥=18æœˆ
  â”‚   â””â”€ è¾“å…¥=24æœˆ
  â”‚
  â”œâ”€ å®éªŒB: ä¸åŒè¡¥å…¨é•¿åº¦
  â”‚   â”œâ”€ åŸºçº¿: ç›´æ¥å›å½’ï¼ˆ12æœˆè¾“å…¥ï¼‰
  â”‚   â”œâ”€ è¡¥å…¨åˆ°18æœˆ
  â”‚   â”œâ”€ è¡¥å…¨åˆ°24æœˆ
  â”‚   â”œâ”€ è¡¥å…¨åˆ°30æœˆ
  â”‚   â””â”€ è¡¥å…¨åˆ°36æœˆ
  â”‚
  â””â”€ ä¿å­˜ç»“æœ
      â”œâ”€ experiment_results/experiment_A_results.json
      â””â”€ experiment_results/experiment_B_results.json
```

**é¢„è®¡æ—¶é—´**ï¼š
- å®éªŒA: 4-6å°æ—¶ï¼ˆ4ä¸ªè¾“å…¥é•¿åº¦ Ã— 2ç§æ–¹æ³•ï¼‰
- å®éªŒB: 2-4å°æ—¶ï¼ˆ5ç§è¡¥å…¨ç­–ç•¥ï¼‰
- æ€»è®¡: 8-12å°æ—¶

### 4. ç»“æœå¯è§†åŒ–ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
python visualize_results.py
```

**ç”Ÿæˆå›¾è¡¨**ï¼š
1. `experiment_A_comparison.png` - å®éªŒAå¯¹æ¯”å›¾
2. `completion_quality_analysis.png` - è¡¥å…¨è´¨é‡åˆ†æ
3. `experiment_B_completion_lengths.png` - å®éªŒBå¯¹æ¯”å›¾
4. `completion_length_curve.png` - è¡¥å…¨é•¿åº¦æ›²çº¿

**æ±‡æ€»è¡¨æ ¼**ï¼š
- æ§åˆ¶å°è¾“å‡ºè¯¦ç»†å¯¹æ¯”è¡¨æ ¼
- å¹³å‡æ€§èƒ½æå‡
- æœ€ä¼˜ç­–ç•¥æ¨è

## é¢„æœŸç»“æœ

### å‡è®¾1ï¼šç›´æ¥æ³•æ•´ä½“æ›´ä¼˜ï¼ˆç½®ä¿¡åº¦ï¼šé«˜ï¼‰

**ç†è®ºä¾æ®**ï¼š
- é¿å…è¯¯å·®ç´¯ç§¯
- ç«¯åˆ°ç«¯ä¼˜åŒ–
- æ¨¡å‹æ›´ç®€å•
- è®­ç»ƒ-æµ‹è¯•ä¸€è‡´

**é¢„æœŸæ€§èƒ½å·®å¼‚**ï¼š
| è¾“å…¥é•¿åº¦ | é¢„æœŸæå‡ |
|---------|---------|
| 6ä¸ªæœˆ | +20-30% |
| 12ä¸ªæœˆ | +15-25% |
| 18ä¸ªæœˆ | +10-20% |
| 24ä¸ªæœˆ | +5-15% |

### å‡è®¾2ï¼šå­˜åœ¨æœ€ä¼˜è¡¥å…¨é•¿åº¦ï¼ˆç½®ä¿¡åº¦ï¼šä¸­ï¼‰

**é¢„æœŸæ›²çº¿**ï¼š

```
RMSE â†‘
     |
 1.5 |    â•±â€¾â€¾â•²
     |   â•±    â•²___
 1.0 |__â•±         â•²___
     |
     +â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ è¡¥å…¨é•¿åº¦
     12  18  24  30  36
```

**é¢„æœŸæœ€ä¼˜ç‚¹**ï¼š20-24ä¸ªæœˆ

**åŸå› **ï¼š
- è¡¥å…¨å¤ªå°‘ï¼šä¿¡æ¯ä¸è¶³
- è¡¥å…¨å¤ªå¤šï¼šç´¯ç§¯è¯¯å·®
- é€‚åº¦è¡¥å…¨ï¼šå¹³è¡¡ç‚¹

### å‡è®¾3ï¼šè¡¥å…¨è´¨é‡ä¸å›å½’æ€§èƒ½æ­£ç›¸å…³ï¼ˆç½®ä¿¡åº¦ï¼šé«˜ï¼‰

**é¢„æœŸ**ï¼š
- è¡¥å…¨è´¨é‡è¶Šé«˜ï¼ˆåºåˆ—RMSEè¶Šä½ï¼‰ï¼Œå›å½’æ€§èƒ½è¶Šå¥½
- ç›¸å…³ç³»æ•° r > 0.7
- ä½†å³ä½¿è¡¥å…¨è´¨é‡é«˜ï¼Œä»ä¸å¦‚ç›´æ¥æ³•

## æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒè„šæœ¬

| æ–‡ä»¶ | è¯´æ˜ | è¿è¡Œæ—¶é—´ |
|------|------|---------|
| `quick_validation.py` | å¿«é€ŸéªŒè¯ï¼ˆå°æ•°æ®ï¼‰ | 30åˆ†é’Ÿ |
| `run_full_experiment.py` | å®Œæ•´å®éªŒ | 8-12å°æ—¶ |
| `visualize_results.py` | ç»“æœå¯è§†åŒ– | 5åˆ†é’Ÿ |
| `compare_methods.py` | åŸºç¡€å¯¹æ¯”ï¼ˆå•æ¬¡ï¼‰ | 1å°æ—¶ |

### æ¨¡å‹å®šä¹‰

- `DirectRegressor`: ç›´æ¥å›å½’æ¨¡å‹ï¼ˆåŸºçº¿ï¼‰
- `TwoStageRegressor`: ä¸¤é˜¶æ®µæ¨¡å‹ï¼ˆè¡¥å…¨+å›å½’ï¼‰

### æ•°æ®é›†

- `FlexibleYieldDataset`: çµæ´»çš„äº§é‡æ•°æ®é›†
  - æ”¯æŒä»»æ„è¾“å…¥é•¿åº¦
  - æ”¯æŒä»»æ„è¡¥å…¨ç›®æ ‡é•¿åº¦
  - è‡ªåŠ¨å½’ä¸€åŒ–

### å®éªŒè®¾è®¡æ–‡æ¡£

- `EXPERIMENT_DESIGN.md`: å®Œæ•´å®éªŒè®¾è®¡æ–¹æ¡ˆ
- `TWO_STAGE_VS_DIRECT_ANALYSIS.md`: ç†è®ºåˆ†æ

## ç»“æœè§£è¯»

### åœºæ™¯1ï¼šç›´æ¥æ³•æ˜¾è‘—æ›´å¥½ï¼ˆimprovement > 10%ï¼‰

**ç»“è®º**ï¼š
- âœ… ä½¿ç”¨ç›´æ¥å›å½’æ–¹æ³•
- âŒ ä¸éœ€è¦åºåˆ—è¡¥å…¨
- ç†ç”±ï¼šç«¯åˆ°ç«¯å­¦ä¹ æ›´æœ‰æ•ˆï¼Œé¿å…è¯¯å·®ç´¯ç§¯

**æ¨èæ¶æ„**ï¼š
```python
model = DirectRegressor(input_length=12, hidden_dim=256)
```

### åœºæ™¯2ï¼šä¸¤é˜¶æ®µæ˜¾è‘—æ›´å¥½ï¼ˆimprovement < -10%ï¼‰

**ç»“è®º**ï¼š
- âœ… ä½¿ç”¨ä¸¤é˜¶æ®µæ–¹æ³•
- âœ… å®Œæ•´åºåˆ—ä¿¡æ¯å¾ˆé‡è¦
- ç†ç”±ï¼šè¡¥å…¨å¸¦æ¥çš„ä¿¡æ¯å¢ç›Š > é¢„æµ‹è¯¯å·®

**æ¨èæ¶æ„**ï¼š
```python
model = TwoStageRegressor(
    input_length=12, 
    target_length=æœ€ä¼˜é•¿åº¦,  # ä»å®éªŒBç¡®å®š
    hidden_dim=256
)
```

### åœºæ™¯3ï¼šæ€§èƒ½æ¥è¿‘ï¼ˆ|improvement| < 10%ï¼‰

**ç»“è®º**ï¼š
- ä¼˜å…ˆä½¿ç”¨ç›´æ¥æ³•ï¼ˆæ›´ç®€å•ï¼‰
- æˆ–ä½¿ç”¨ensembleèåˆä¸¤è€…

**æ¨èæ¶æ„**ï¼š
```python
# Ensemble
pred_final = 0.6 * pred_direct + 0.4 * pred_twostage
```

## ç»Ÿè®¡æ£€éªŒ

å®éªŒåŒ…å«ä»¥ä¸‹ç»Ÿè®¡æ£€éªŒï¼š

### 1. é…å¯¹tæ£€éªŒ

```python
# å¯¹äºåŒä¸€æµ‹è¯•é›†
errors_direct = |y_true - y_pred_direct|
errors_twostage = |y_true - y_pred_twostage|

t_statistic, p_value = stats.ttest_rel(errors_direct, errors_twostage)

if p_value < 0.05:
    print("å·®å¼‚å…·æœ‰ç»Ÿè®¡æ˜¾è‘—æ€§")
```

### 2. Bootstrapç½®ä¿¡åŒºé—´

```python
# é‡é‡‡æ ·1000æ¬¡
bootstrap_improvements = []
for _ in range(1000):
    sample_idx = random_sample_with_replacement(test_indices)
    improvement = compute_improvement(sample_idx)
    bootstrap_improvements.append(improvement)

CI_95 = np.percentile(bootstrap_improvements, [2.5, 97.5])
```

## æ¶ˆèå®éªŒï¼ˆå¯é€‰ï¼‰

å¦‚æœæ—¶é—´å…è®¸ï¼Œå¯ä»¥è¿›è¡Œé¢å¤–çš„æ¶ˆèå®éªŒï¼š

### C1: æ¨¡å‹å®¹é‡æ§åˆ¶

```bash
python experiment_ablation_capacity.py
```

æ§åˆ¶æ€»å‚æ•°é‡ç›¸åŒï¼Œå¯¹æ¯”æ€§èƒ½ã€‚

### C2: æ•°æ®é‡å½±å“

```bash
python experiment_ablation_datasize.py
```

æµ‹è¯•ä¸åŒæ•°æ®é‡ä¸‹çš„æ€§èƒ½å˜åŒ–ã€‚

### C3: ç‰¹å¾é‡è¦æ€§

```bash
python experiment_feature_importance.py
```

ä½¿ç”¨SHAPåˆ†æå“ªäº›æ—¶é—´æ­¥æœ€é‡è¦ã€‚

## æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šCUDA OOM

```bash
# å‡å°batch size
python run_full_experiment.py --batch_size 16
```

### é—®é¢˜2ï¼šè®­ç»ƒå¤ªæ…¢

```bash
# å‡å°‘epochs
python run_full_experiment.py --epochs 30
```

### é—®é¢˜3ï¼šç»“æœæ–‡ä»¶ä¸å­˜åœ¨

```bash
# æ£€æŸ¥æ˜¯å¦è¿è¡Œå®Œæˆ
ls experiment_results/

# é‡æ–°è¿è¡Œç‰¹å®šå®éªŒ
python run_full_experiment.py --only_experiment A
```

## å¼•ç”¨

å¦‚æœä½¿ç”¨æœ¬å®éªŒæ¡†æ¶ï¼Œè¯·å¼•ç”¨ç›¸å…³è®ºæ–‡æˆ–æ³¨æ˜æ¥æºã€‚

## ä½œè€…

å®éªŒè®¾è®¡å’Œå®ç°ï¼šVTTé¡¹ç›®å›¢é˜Ÿ

## æ›´æ–°æ—¥å¿—

- 2024-11: åˆå§‹ç‰ˆæœ¬
  - å®éªŒA: è¡¥å…¨ vs ä¸è¡¥å…¨
  - å®éªŒB: ä¸åŒè¡¥å…¨é•¿åº¦
  - å®Œæ•´å¯è§†åŒ–å’Œç»Ÿè®¡åˆ†æ

## è®¸å¯

MIT License

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æissueæˆ–è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚

---

**ç¥å®éªŒæˆåŠŸï¼** ğŸ‰

