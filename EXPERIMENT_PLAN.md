# 🔬 VTT模型产量预测实验计划

## 📋 实验概述

**研究目标**：探索基于遥感时序数据的作物产量早期预测最优方案

**核心问题**：
1. 最少需要多少天的数据才能准确预测产量？
2. 双模态（视觉+语言）vs 纯语言模态哪个更好？
3. 序列补全+回归 vs 直接回归哪个策略更优？

---

## 📊 数据说明

### 数据集构成
- **时间范围**：2019-2022年（4年）
- **样本数量**：每年约500个样本，共约2000个样本
- **时间分辨率**：36步/年，每步=10天，共360天
- **特征维度**：7个遥感波段/指数
  - NIR（近红外）
  - RVI（比值植被指数）
  - SWIR1（短波红外1）
  - blue（蓝光波段）
  - EVI（增强植被指数）
  - NDVI（归一化植被指数）
  - red（红光波段）
- **预测目标**：产量（y2019/y2020/y2021/y2022）

### 数据划分策略
```
训练集：2019 + 2020 + 2021（1500样本）
测试集：2022（500样本）
验证集：从训练集中随机抽取20%
```

---

## 🎯 实验设计

### 实验一：时间步数敏感性分析（已准备）

**目标**：找到最短的有效预测时间点

#### 实验1A：双模态模型
- **模型**：`SimpleYieldPredictor`（视觉+语言）
- **输入步数**：[6, 12, 18, 24, 30, 36]步
- **对应天数**：[60, 120, 180, 240, 300, 360]天
- **对应月数**：[2, 4, 6, 8, 10, 12]个月

#### 实验1B：纯语言模态
- **模型**：`LanguageOnlyYieldPredictor`
- **输入步数**：[6, 12, 18, 24, 30, 36]步

#### 评估指标
- **RMSE**（Root Mean Square Error）：主要指标
- **MAE**（Mean Absolute Error）：绝对误差
- **R²**（R-squared）：拟合优度
- **MAPE**（Mean Absolute Percentage Error）：百分比误差

#### 运行脚本
```bash
# 快速测试（10个epoch）
python experiments/yield_prediction/train_comparison.py --quick

# 完整训练（100个epoch）
python experiments/yield_prediction/train_comparison.py
```

#### 预期结果
| 步数 | 天数 | 双模态RMSE | 语言模态RMSE | 最优模型 |
|------|------|------------|--------------|----------|
| 6    | 60   | ?          | ?            | ?        |
| 12   | 120  | ?          | ?            | ?        |
| 18   | 180  | ?          | ?            | ?        |
| 24   | 240  | ?          | ?            | ?        |
| 30   | 300  | ?          | ?            | ?        |
| 36   | 360  | ?          | ?            | ?        |

---

### 实验二：序列补全策略对比（待实现）

**目标**：比较两阶段方法（补全+回归）vs 端到端直接回归

#### 实验2A：端到端直接回归（基线）
- **方法**：输入12步 → 直接预测产量
- **模型**：`SimpleYieldPredictor`（time_steps=12）
- **流程**：
  ```
  遥感序列[12步] → 特征提取 → 回归器 → 产量
  ```

#### 实验2B：两阶段方法（补全18步）
- **方法**：输入12步 → 补全到18步 → 预测产量
- **模型**：`TimesCLIP`（补全） + `YieldPredictor`（回归）
- **流程**：
  ```
  遥感序列[12步] → 序列补全器 → 完整序列[18步] → 回归器 → 产量
  ```

#### 实验2C：两阶段方法（补全24步）
- **方法**：输入12步 → 补全到24步 → 预测产量

#### 实验2D：两阶段方法（补全36步）
- **方法**：输入12步 → 补全到36步 → 预测产量

#### 需要实现的组件
```python
# 1. 序列补全模型
class SequenceCompletionModel:
    def forward(self, x, input_steps, target_steps):
        # 输入: [B, input_steps, V]
        # 输出: [B, target_steps, V]
        return completed_sequence

# 2. 两阶段训练脚本
# experiments/two_stage/train_completion_then_regression.py
```

---

### 实验三：输入长度敏感性分析（待实现）

**目标**：固定补全长度，探索不同输入长度的影响

#### 设置
- **固定补全目标**：36步（全年）
- **变化输入长度**：[3, 6, 9, 12, 15, 18]步
- **评估指标**：补全质量（MSE）+ 产量预测精度（RMSE）

#### 预期发现
- 输入越长，补全质量越好
- 但存在一个"最小有效输入"阈值
- 找到**成本-精度**的最优平衡点

---

### 实验四：消融实验（待实现）

**目标**：分析各个模块的贡献度

#### 实验4A：特征消融
- **移除视觉模态**（已有结果）
- **移除语言模态**：只用视觉特征
- **移除对比学习**：只用单模态特征

#### 实验4B：波段消融
- **全部7个波段**（基线）
- **移除NIR**
- **移除NDVI**
- **仅用植被指数**（NDVI + EVI + RVI）
- **仅用光谱波段**（blue + red + NIR + SWIR1）

#### 实验4C：模型结构消融
- **Patch embedding**：有 vs 无
- **Transformer层数**：[2, 4, 6, 8]层
- **注意力头数**：[4, 8, 16]头

---

## 📁 实验文件组织

```
experiments/
├── yield_prediction/              # ✅ 实验一（已完成）
│   ├── train.py                   # 单模型训练
│   ├── train_comparison.py        # 双模态vs语言对比
│   ├── data_loader.py             # 数据加载器
│   └── results/                   # 结果保存
│
├── two_stage/                     # ⏳ 实验二（待实现）
│   ├── train_completion.py        # 第一阶段：序列补全
│   ├── train_regression.py        # 第二阶段：产量回归
│   ├── train_end_to_end.py        # 端到端联合训练
│   └── compare_strategies.py      # 策略对比
│
├── input_sensitivity/             # ⏳ 实验三（待实现）
│   ├── train_variable_input.py    # 可变输入长度训练
│   └── analyze_tradeoff.py        # 成本-精度分析
│
└── ablation/                      # ⏳ 实验四（待实现）
    ├── train_feature_ablation.py  # 特征消融
    ├── train_band_ablation.py     # 波段消融
    └── train_model_ablation.py    # 模型结构消融
```

---

## 🚀 实验执行顺序

### 第一阶段：基线建立（本周）
1. ✅ **运行实验一**：时间步数敏感性分析
   ```bash
   python experiments/yield_prediction/train_comparison.py
   ```
2. **分析结果**：确定最优时间步数
3. **撰写报告**：记录基线性能

### 第二阶段：策略对比（下周）
4. **实现实验二**：两阶段 vs 端到端
5. **对比分析**：哪种策略更优？
6. **可视化**：绘制性能对比图

### 第三阶段：深入优化（下下周）
7. **实现实验三**：输入长度优化
8. **实现实验四**：消融实验
9. **综合分析**：撰写完整报告

---

## 📈 预期产出

### 实验结果
1. **性能对比表**：各模型在不同设置下的指标
2. **可视化图表**：
   - 时间步数 vs 预测精度曲线
   - 双模态 vs 语言模态对比图
   - 补全长度 vs 预测精度热力图
3. **最优配置**：找到最佳模型+最佳时间点

### 学术产出
1. **技术报告**：完整实验记录
2. **论文初稿**：可投稿到会议/期刊
3. **开源代码**：完整可复现的代码库

---

## 🎓 科研价值

### 理论贡献
1. **早期预测**：探索产量预测的时间下界
2. **多模态融合**：验证视觉-语言模态在时序任务中的有效性
3. **策略对比**：为两阶段 vs 端到端提供实证依据

### 实际应用
1. **农业保险**：提前60天预测产量，降低风险
2. **市场预测**：早期预估供应量，辅助决策
3. **精准农业**：及时干预，提高产量

---

## ⚙️ 实验配置建议

### 硬件要求
- **GPU**：建议RTX 3090 / A100（24GB+）
- **内存**：32GB+
- **存储**：100GB+（存储checkpoints和结果）

### 训练参数
```python
# 快速测试
batch_size = 64
epochs = 10
learning_rate = 1e-4

# 完整训练
batch_size = 32
epochs = 100
learning_rate = 1e-4
early_stopping_patience = 15
```

### 超参数搜索（可选）
- **学习率**：[1e-3, 1e-4, 1e-5]
- **Batch size**：[16, 32, 64]
- **模型维度**：[128, 256, 512]
- **Dropout**：[0.1, 0.2, 0.3]

---

## 📝 记录规范

### 每次实验需记录
1. **日期和时间**
2. **实验编号**（如：Exp1A-20241110）
3. **模型配置**（超参数、结构）
4. **数据配置**（训练集、测试集）
5. **训练时长**
6. **最终指标**（RMSE, MAE, R², MAPE）
7. **保存路径**（checkpoints, logs）
8. **备注**（异常情况、观察）

### 实验日志示例
```
==================================================
实验编号: Exp1A-001
日期: 2024-11-10 14:30
模型: SimpleYieldPredictor (dual-modal)
输入步数: 6
训练集: 2019-2021 (1500 samples)
测试集: 2022 (500 samples)
超参数:
  - batch_size: 32
  - learning_rate: 1e-4
  - epochs: 100
结果:
  - Test RMSE: 0.5421
  - Test MAE: 0.4123
  - Test R²: 0.8567
  - Test MAPE: 8.32%
训练时长: 45分钟
Checkpoint: checkpoints/exp1a_001_best.pth
备注: 收敛稳定，无过拟合
==================================================
```

---

## 🎯 下一步行动

### 立即执行
1. **运行实验一完整训练**：
   ```bash
   cd experiments/yield_prediction
   python train_comparison.py
   ```

2. **监控训练**：
   ```bash
   # 另一个终端
   watch -n 5 nvidia-smi
   ```

3. **可视化结果**：
   ```bash
   python ../../visualize_trained_results.py
   ```

### 本周内完成
- [ ] 实验一完整结果
- [ ] 绘制时间步数敏感性曲线
- [ ] 确定最优时间点
- [ ] 撰写阶段性报告

---

## 📞 问题讨论

如有以下情况，需及时讨论：
1. 模型无法收敛
2. 所有时间步性能相近（无敏感性）
3. 双模态显著差于语言模态
4. 出现异常高的MAPE值

---

**实验计划制定时间**：2024-11-10  
**预计完成时间**：2024-11-30（3周）  
**负责人**：[你的名字]

---

## 🔄 版本历史
- v1.0 (2024-11-10): 初始版本

